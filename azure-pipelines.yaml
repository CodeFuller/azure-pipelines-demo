pool:
  name: Azure Pipelines
  vmImage: ubuntu-latest

  variables:
  aws.region: us-east-1

stages:
- stage: BuildStage
  displayName: Build Stage
  jobs:
  - job: BuildJob
    displayName: Build Job
    steps:
    - powershell: 'Copy-Item "version.txt" -Destination "app-version.txt"'

- stage: DeployStage
  displayName: Deploy Stage
  jobs:
  - job: DeployJob
    displayName: Deploy Job
    steps:
    - task: S3Upload@1
      displayName: 'Deploy to S3'
      inputs:
        awsCredentials: '$(AwsCredentials)'
        bucketName: '$(TargetBucketName)'
        sourceFolder: .
        globExpressions: app-version.txt
        filesAcl: public-read
